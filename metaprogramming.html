<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2020-04-17 Fri 20:05 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CS490 Metaprogramming</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Shukry Zablah">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<style>pre.src{background:#343131;color:white;} </style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">CS490 Metaprogramming</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9459a9f">1. Unit 1: Tear Down/Build Up</a>
<ul>
<li><a href="#org878b8d3">1.1. Tasks</a>
<ul>
<li><a href="#orga34b3b6">1.1.1. On Lisp <code>[6/6]</code></a></li>
<li><a href="#orgfd8da43">1.1.2. Turing's Cathedral</a></li>
<li><a href="#org04e7a62">1.1.3. History of Lisp</a></li>
</ul>
</li>
<li><a href="#org40f474a">1.2. Code Snippets</a>
<ul>
<li><a href="#org538d648">1.2.1. Hello World</a></li>
<li><a href="#org691be65">1.2.2. Fun with S-expressions: Backwards Expressions</a></li>
<li><a href="#org53163f9">1.2.3. Loop DSL: Fibonacci Numbers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdac4379">2. Unit 2: New Territory</a>
<ul>
<li><a href="#org3de0aa0">2.1. Tasks</a>
<ul>
<li><a href="#orge9d1e47">2.1.1. On Lisp <code>[8/8]</code></a></li>
<li><a href="#org42985ff">2.1.2. Eliza &amp; PAIP</a></li>
<li><a href="#orgf589d95">2.1.3. Let over Lambda</a></li>
<li><a href="#orgcde447f">2.1.4. Supplementary Material</a></li>
</ul>
</li>
<li><a href="#org10971da">2.2. Code Snippets</a>
<ul>
<li><a href="#orgb7a2dc1">2.2.1. Eliza</a></li>
<li><a href="#org53df639">2.2.2. New Control Structures</a></li>
<li><a href="#org312395f">2.2.3. Use Package Macro in Emacs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd6881da">3. Unit 3: Application</a>
<ul>
<li><a href="#orgf8960de">3.1. Tasks</a>
<ul>
<li><a href="#org88a7d94">3.1.1. <span class="todo TODO">TODO</span> Prolog</a></li>
<li><a href="#orgb16c163">3.1.2. <span class="todo TODO">TODO</span> Metaprogramming Survey</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
Goal: Develop an understanding and appreciation for the concept and
practice of metaprogramming as an advanced topic in programming
language theory and programming language paradigms.
</p>

<div id="outline-container-org9459a9f" class="outline-2">
<h2 id="org9459a9f"><span class="section-number-2">1</span> Unit 1: Tear Down/Build Up</h2>
<div class="outline-text-2" id="text-1">
<p>
In the first part of the course, I broke down my mental model of
programming. This was important to build a better one. In this unit, I
familiarized myself with the concepts of bottom-up programming, and
the central role of function composition in proper bottom-up
design. Also important was an introduction to programming language
theory and the idea behind S-expressions. 
</p>
</div>
<div id="outline-container-org878b8d3" class="outline-3">
<h3 id="org878b8d3"><span class="section-number-3">1.1</span> Tasks</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-orga34b3b6" class="outline-4">
<h4 id="orga34b3b6"><span class="section-number-4">1.1.1</span> On Lisp <code>[6/6]</code></h4>
<div class="outline-text-4" id="text-1-1-1">
</div>
<ol class="org-ol">
<li><a id="orge662569"></a><span class="done DONE">DONE</span> Ch1. The Extensible Language<br></li>
<li><a id="orgc0eb8f7"></a><span class="done DONE">DONE</span> Ch2. Functions<br></li>
<li><a id="org77d1f05"></a><span class="done DONE">DONE</span> Ch3. Functional Programming<br></li>
<li><a id="org6db0c70"></a><span class="done DONE">DONE</span> Ch4. Utility Functions<br></li>
<li><a id="orgc2b1d1a"></a><span class="done DONE">DONE</span> Ch5. Returning Functions<br></li>
</ol>
</div>
<div id="outline-container-orgfd8da43" class="outline-4">
<h4 id="orgfd8da43"><span class="section-number-4">1.1.2</span> Turing's Cathedral</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
Mathematicians, WWII, artillery, atom bomb, Hungarians, RAM, and
more.
</p>
</div>
</div>
<div id="outline-container-org04e7a62" class="outline-4">
<h4 id="org04e7a62"><span class="section-number-4">1.1.3</span> History of Lisp</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
<a href="https://en.wikipedia.org/wiki/Lisp_(programming_language)">https://en.wikipedia.org/wiki/Lisp_(programming_language)</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org40f474a" class="outline-3">
<h3 id="org40f474a"><span class="section-number-3">1.2</span> Code Snippets</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org538d648" class="outline-4">
<h4 id="org538d648"><span class="section-number-4">1.2.1</span> Hello World</h4>
<div class="outline-text-4" id="text-1-2-1">
<div class="org-src-container">
<pre class="src src-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">hello-world</span> ()
    (format t <span style="color: #CC9393;">"Hello World!"</span>))

(hello-world)
</pre>
</div>

<pre class="example">
Hello World!

</pre>
</div>
</div>
<div id="outline-container-org691be65" class="outline-4">
<h4 id="org691be65"><span class="section-number-4">1.2.2</span> Fun with S-expressions: Backwards Expressions</h4>
<div class="outline-text-4" id="text-1-2-2">
<div class="org-src-container">
<pre class="src src-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">backwards</span> (expr)
  (reverse expr))

(equal 4 (backwards (2 2 +)))
</pre>
</div>

<pre class="example">
T

</pre>
</div>
</div>

<div id="outline-container-org53163f9" class="outline-4">
<h4 id="org53163f9"><span class="section-number-4">1.2.3</span> Loop DSL: Fibonacci Numbers</h4>
<div class="outline-text-4" id="text-1-2-3">
<div class="org-src-container">
<pre class="src src-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">print-fibs-en</span> (nth)
  (<span style="color: #F0DFAF; font-weight: bold;">loop</span> for i below nth
     and a = 0 then b
     and b = 1 then (+ b a)
     do (format t <span style="color: #CC9393;">"~r~%"</span> a)))

(print-fibs-en 10)
</pre>
</div>

<pre class="example">
zero
one
one
two
three
five
eight
thirteen
twenty-one
thirty-four
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdac4379" class="outline-2">
<h2 id="orgdac4379"><span class="section-number-2">2</span> Unit 2: New Territory</h2>
<div class="outline-text-2" id="text-2">
<p>
In the second part of the course I build on the new model of
programming I developed in Unit 1. I learn how to use the macro system
in Lisp and how it works. Since it is a new type of abstraction there
is a lot of ground that had to be covered. 
</p>
</div>
<div id="outline-container-org3de0aa0" class="outline-3">
<h3 id="org3de0aa0"><span class="section-number-3">2.1</span> Tasks</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-orge9d1e47" class="outline-4">
<h4 id="orge9d1e47"><span class="section-number-4">2.1.1</span> On Lisp <code>[8/8]</code></h4>
<div class="outline-text-4" id="text-2-1-1">
</div>
<ol class="org-ol">
<li><a id="org220c987"></a><span class="done DONE">DONE</span> Ch6. Functions as Representation<br></li>
<li><a id="orgf767721"></a><span class="done DONE">DONE</span> Ch7. Macros<br></li>
<li><a id="org240951e"></a><span class="done DONE">DONE</span> Ch8. When to Use Macros<br></li>
<li><a id="orgdf40552"></a><span class="done DONE">DONE</span> Ch9. Variable Capture<br></li>
<li><a id="orga5257ed"></a><span class="done DONE">DONE</span> Ch10. Other Macro Pitfalls<br></li>
<li><a id="org04cf202"></a><span class="done DONE">DONE</span> Ch11. Classic Macros<br></li>
<li><a id="orgd77bf55"></a><span class="done DONE">DONE</span> Ch12. Generalized Variables<br></li>
<li><a id="org195a67d"></a><span class="done DONE">DONE</span> Ch13. Computation at Compile-Time<br></li>
</ol>
</div>
<div id="outline-container-org42985ff" class="outline-4">
<h4 id="org42985ff"><span class="section-number-4">2.1.2</span> Eliza &amp; PAIP</h4>
</div>
<div id="outline-container-orgf589d95" class="outline-4">
<h4 id="orgf589d95"><span class="section-number-4">2.1.3</span> Let over Lambda</h4>
</div>
<div id="outline-container-orgcde447f" class="outline-4">
<h4 id="orgcde447f"><span class="section-number-4">2.1.4</span> Supplementary Material</h4>
<div class="outline-text-4" id="text-2-1-4">
</div>
<ol class="org-ol">
<li><a id="orgd1f1590"></a>The Law of Leaky Abstractions<br></li>
<li><a id="org0df79c3"></a>Homoiconicity<br></li>
<li><a id="org61a2cd0"></a>Metaprogramming<br></li>
<li><a id="orgb85a8a4"></a>Lisp at the Frontier of Computation (Robert Smith @ Rigetti Computing)<br></li>
</ol>
</div>
</div>
<div id="outline-container-org10971da" class="outline-3">
<h3 id="org10971da"><span class="section-number-3">2.2</span> Code Snippets</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-orgb7a2dc1" class="outline-4">
<h4 id="orgb7a2dc1"><span class="section-number-4">2.2.1</span> Eliza</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">
<pre class="src src-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defconstant</span> <span style="color: #DFAF8F;">fail</span> nil <span style="color: #9FC59F;">"Indicates pattern-match failure"</span>)
(<span style="color: #F0DFAF; font-weight: bold;">defconstant</span> <span style="color: #DFAF8F;">no-bindings</span> '((t . t))
  <span style="color: #9FC59F;">"Indicates pat-match success, with no variables"</span>)

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">variable-p</span> (x)
  <span style="color: #9FC59F;">"Is x a variable (a symbol beginning with '?')?"</span>
  (and (symbolp x) (equal (char (symbol-name x) 0) #\?)))


(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">get-binding</span> (var bindings)
  <span style="color: #9FC59F;">"Find a (variable . value) pair in a binding list."</span>
  (assoc var bindings))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">binding-val</span> (binding)
  <span style="color: #9FC59F;">"Get the value part of a single binding."</span>
  (cdr binding))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">lookup</span> (var bindings)
  <span style="color: #9FC59F;">"Get the value part (for var) from a binding list."</span>
  (binding-val (get-binding var bindings)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">extend-bindings</span> (var val bindings)
  <span style="color: #9FC59F;">"Add a (var . value) pair to a binding list."</span>
  (cons (cons var val)
        (<span style="color: #F0DFAF; font-weight: bold;">if</span> (eq bindings no-bindings)
            nil
            bindings)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">pattern-match</span> (pattern input <span style="color: #7CB8BB;">&amp;optional</span> (bindings no-bindings))
  <span style="color: #9FC59F;">"Match pattern against input in the context of the bindings."</span>
  (<span style="color: #F0DFAF; font-weight: bold;">cond</span> ((eq bindings fail) fail)
        ((variable-p pattern)
         (match-variable pattern input bindings))
        ((eql pattern input) bindings)
        ((segment-pattern-p pattern)
         (segment-match pattern input bindings))
        ((and (consp pattern) (consp input))
         (pattern-match (rest pattern) (rest input)
                        (pattern-match (first pattern) (first input)
                                       bindings)))
        (t fail)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">match-variable</span> (var input bindings)
  <span style="color: #9FC59F;">"Does VAR match input? Uses (or updates) and returns bindings."</span>
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((binding (get-binding var bindings)))
    (<span style="color: #F0DFAF; font-weight: bold;">cond</span> ((not binding) (extend-bindings var input bindings))
          ((equal input (binding-val binding)) bindings)
          (t fail))))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">starts-with</span> (list x)
  <span style="color: #9FC59F;">"Is this a list whose first element is x?"</span>
  (and (consp list) (eql (car list) x)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">segment-pattern-p</span> (pattern)
  <span style="color: #9FC59F;">"Is this a segment matching pattern: ((?* var) . pat)"</span>
  (and (consp pattern)
       (starts-with (first pattern) '?*)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">segment-match</span> (pattern input bindings <span style="color: #7CB8BB;">&amp;optional</span> (start 0))
  <span style="color: #9FC59F;">"Match the segment pattern ((?* var) . pat) against input."</span>
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((var (second (first pattern)))
        (pat (rest pattern)))
    (<span style="color: #F0DFAF; font-weight: bold;">if</span> (null pat)
        (match-variable var input bindings)
        (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((pos (position (first pat) input
                             <span style="color: #DCDCCC; font-weight: bold;">:start</span> start <span style="color: #DCDCCC; font-weight: bold;">:test</span> #'equal)))
          (<span style="color: #F0DFAF; font-weight: bold;">if</span> (null pos)
              fail
              (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((b2 (pattern-match
                         pat (subseq input pos)
                         (match-variable var (subseq input 0 pos)
                                         bindings))))
                (<span style="color: #F0DFAF; font-weight: bold;">if</span> (eq b2 fail)
                    (segment-match pattern input bindings (+ pos 1))
                    b2)))))))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">rule-pattern</span> (rule) (car rule))
(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">rule-responses</span> (rule) (cdr rule))

(<span style="color: #F0DFAF; font-weight: bold;">defparameter</span> <span style="color: #DFAF8F;">*eliza-rules*</span>
  '((((?* ?x) hello (?* ?y))
     (How do you do. Please state your problem.))
    (((?* ?x) computer (?* ?y))
     (<span style="color: #F0DFAF; font-weight: bold;">Do</span> computers worry you?) (What do you think about machines?)
     (Why do you mention computers?)
     (What do you think machines have to do with your problem?))
    (((?* ?x) name (?* ?y))
     (I am not interested in names))
    (((?* ?x) sorry (?* ?y))
     (Please don't apologize) (Apologies are not necessary)
     (What feelings do you have when you apologize))
    (((?* ?x) I remember (?* ?y))
     (<span style="color: #F0DFAF; font-weight: bold;">Do</span> you often think of ?y)
     (Does thinking of ?y bring anything else to mind?)
     (What else do you remember) (Why do you recall ?y right now?)
     (What in the present situation reminds you of ?y)
     (What i s the connection between me and ?y))
    (((?* ?x) do you remember (?* ?y))
     (Did you think I would forget ?y ?)
     (Why do you think I should recall ?y now)
     (What about ?y) (You mentioned ?y))
    (((?* ?x) if (?* ?y))
     (<span style="color: #F0DFAF; font-weight: bold;">Do</span> you really think its likely that ?y) (<span style="color: #F0DFAF; font-weight: bold;">Do</span> you wish that ?y)
     (What do you think about ?y) (Really-- if ?y))
    (((?* ?x) I dreamt (?* ?y))
     (Really-- ?y) (Have you ever fantasized ?y while you were awake?)
     (Have you dreamt ?y before?))
    (((?* ?x) dream about (?* ?y))
     (How do you feel about ?y in reality?))
    (((?* ?x) dream (?* ?y))
     (What does this dream suggest to you?) (<span style="color: #F0DFAF; font-weight: bold;">Do</span> you dream often?)
     (What persons appear in your dreams?)
     (Don't you believe that dream has to do with your problem?))
    (((?* ?x) my mother (?* ?y))
     (Who else in your family ?y) (Tell me more about your family))
    (((?* ?x) my father (?* ?y))
     (Your father) (Does he influence you strongly?)
     (What else comes to mind when you think of your father?))
    (((?* ?x) I want (?* ?y))
     (What would it mean if you got ?y)
     (Why do you want ?y) (Suppose you got ?y soon))
    (((?* ?x) I am glad (?* ?y))
     (How have I helped you to be ?y) (What makes you happy just now)
     (Can you explain why you are suddenly ?y))
    (((?* ?x) I am sad (?* ?y))
     (I am sorry to hear you are depressed)
     (I 'm sure i t ' s not pleasant to be sad))
    (((?* ?x) are like (?* ?y))
     (What resemblance do you see between ?x and ?y))
    (((?* ?x) i s like (?* ?y))
     (In what way is it that ?x is like ?y)
     (What resemblance do you see?)
     (Could there really be some connection?) (How?))
    (((?* ?x) alike (?* ?y))
     (In what way?) (What s i m i l a r i t i e s are there?))
    (((?* ?x) same (?* ?y))
     (What other connections do you see?))
    (((?* ?x) I was (?* ?y))
     (Were you really ?) (Perhaps I already knew you were ?y)
     (Why do you tell me you were ?y now?))
    (((?* ?x) was I (?* ?y))
     (What if you were ?y ?) (<span style="color: #F0DFAF; font-weight: bold;">Do</span> you think you were ?y)
     (What would it mean if you were ?y))
    (((?* ?x) I am (?* ?y))
     (In what way are you ?y) (<span style="color: #F0DFAF; font-weight: bold;">Do</span> you want to be ?y ?))
    (((?* ?x) am I (?* ?y))
     (<span style="color: #F0DFAF; font-weight: bold;">Do</span> you believe you are ?y) (Would you want to be ?y)
     (You wish I would tell you you are ?y)
     (What would it mean if you were ?y))
    (((?* ?x) am (?* ?y))
     (Why do you say <span style="color: #CC9393;">"AM?"</span>) (I don't understand that))
    (((?* ?x) are you (?* ?y))
     (Why are you interested in whether I am ?y or not?)
     (Would you prefer if I weren't ?y)
     (Perhaps I am ?y in your fantasies))
    (((?* ?x) you are (?* ?y))
     (What makes you think I am ?y ?))
    (((?* ?x) because (?* ?y))
     (Is that the real reason?) (What other reasons might there be?)
     (Does that reason seem to explain anything else?))
    (((?* ?x) were you (?* ?y))
     (Perhaps I was ?y) (What do you think?) (What if I had been ?y))
    (((?* ?x) I can't (?* ?y))
     (Maybe you could ?y now) (What if you could ?y ?))
    (((?* ?x) I feel (?* ?y))
     (<span style="color: #F0DFAF; font-weight: bold;">Do</span> you often feel ?y ?))
    (((?* ?x) I felt (?* ?y))
     (What other feelings do you have?))
    (((?* ?x) I (?* ?y) you (?* ?z))
     (Perhaps in your fantasy we ?y each other))
    (((?* ?x) why don't you (?* ?y))
     (Should you ?y yourself?)
     (<span style="color: #F0DFAF; font-weight: bold;">Do</span> you believe I don't ?y) (Perhaps I will ?y in good time))
    (((?* ?x) yes (?* ?y))
     (You seem quite positive) (You are sure) (I understand))
    (((?* ?x) no (?* ?y))
     (Why not?) (You are being a bit negative)
     (Are you saying <span style="color: #CC9393;">"NO"</span> just to be negative?))
    (((?* ?x) someone (?* ?y))
     (Can you be more specific?))
    (((?* ?x) everyone (?* ?y))
     (surely not everyone) (Can you think of anyone in particular?)
     (Who for example?) (You are thinking of a special person))
    (((?* ?x) always (?* ?y))
     (Can you think of a specific example) (When?)
     (What incident are you thinking of?) (Really-- always))
    (((?* ?x) what (?* ?y))
     (Why do you ask?) (Does that question interest you?)
     (What is it you really want to know?) (What do you think?)
     (What comes to your mind when you ask that?))
    (((?* ?x) perhaps (?* ?y))
     (You do not seem quite certain))
    (((?* ?x) are (?* ?y))
     (Did you think they might not be ?y)
     (Possibly they are ?y))
    (((?* ?x))
     (Very interesting) (I am not sure I understand you fully)
     (What does that suggest to you?) (Please continue) (<span style="color: #F0DFAF; font-weight: bold;">Go</span> on)
     (<span style="color: #F0DFAF; font-weight: bold;">Do</span> you feel strongly about discussing such things?))))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">eliza</span> ()
   <span style="color: #9FC59F;">"Respond to user input using pattern matching rules."</span>
   (<span style="color: #F0DFAF; font-weight: bold;">loop</span>
      (print 'eliza&gt;)
      (<span style="color: #F0DFAF; font-weight: bold;">let*</span> ((input (read-line-no-punct))
              (response (flatten (use-eliza-rules input))))
           (print-with-spaces response)
           (<span style="color: #F0DFAF; font-weight: bold;">if</span> (equal input '(bye)) (<span style="color: #F0DFAF; font-weight: bold;">RETURN</span>)))))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">read-line-no-punct</span> ()
  <span style="color: #9FC59F;">"Read an input line, ignoring punctuation."</span>
  (read-from-string
   (concatenate 'string <span style="color: #CC9393;">"("</span> (substitute-if #\space #'punctuation-p
             (read-line))
    <span style="color: #CC9393;">")"</span>)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">punctuation-p</span> (char) (find char <span style="color: #CC9393;">".,;:'!?#-()\\\""</span>))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">print-with-spaces</span> (list)
  (format t <span style="color: #CC9393;">"~{~a ~}"</span> list))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">use-eliza-rules</span> (input)
  <span style="color: #9FC59F;">"Find some rule with which to transform the input."</span>
  (some #'(<span style="color: #F0DFAF; font-weight: bold;">lambda</span> (rule)
            (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((result (pattern-match (rule-pattern rule) input)))
              (<span style="color: #F0DFAF; font-weight: bold;">if</span> (not (eq result fail))
                  (sublis (switch-viewpoint result)
                          (random-elt (rule-responses rule))))))
        *eliza-rules*))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">switch-viewpoint</span> (words)
  <span style="color: #9FC59F;">"Change I to you and vice versa, and so on."</span>
  (sublis '((I . you) (you . I) (me . you) (am . are))
          words))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">flatten</span> (the-list)
  <span style="color: #9FC59F;">"Append together elements (or lists) in the list."</span>
  (mappend #'mklist the-list))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">mklist</span> (x)
  <span style="color: #9FC59F;">"Return x if it is a list, otherwise (x)."</span>
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (listp x)
      x
      (list x)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">mappend</span> (fn the-list)
  <span style="color: #9FC59F;">"Apply fn to each element of list and append the results."</span>
  (apply #'append (mapcar fn the-list)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">random-elt</span> (choices)
  <span style="color: #9FC59F;">"Choose an element from a list at random."</span>
  (elt choices (random (length choices))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org53df639" class="outline-4">
<h4 id="org53df639"><span class="section-number-4">2.2.2</span> New Control Structures</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
It is not only easy, but encouraged at the most basic level of
bottom-up programming to create new control structures that capture
code repetition or are clearer.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">nif</span> (expr pos zero neg)
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((g (gensym)))
    `(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((,g ,expr))
       (<span style="color: #F0DFAF; font-weight: bold;">cond</span> ((plusp ,g) ,pos)
             ((zerop ,g) ,zero)
             (t ,neg)))))

(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">while</span> (test <span style="color: #7CB8BB;">&amp;body</span> body)
  `(<span style="color: #F0DFAF; font-weight: bold;">do</span> ()
    ((not ,test))
    ,@body))
</pre>
</div>
</div>
</div>

<div id="outline-container-org312395f" class="outline-4">
<h4 id="org312395f"><span class="section-number-4">2.2.3</span> Use Package Macro in Emacs</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
I use the use-package macro in emacs all the time. The macro is a way
to organize a config and not only is more readable, but it way easier
to have a config that loads in &lt; 2 seconds. Below is an example
declaration for setting up the the common lisp environment and what
the code expands to. 
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(macroexpand-all '(<span style="color: #F0DFAF; font-weight: bold;">use-package</span> <span style="color: #BFEBBF;">slime</span>
                    <span style="color: #DCDCCC; font-weight: bold;">:config</span>
                    (load (expand-file-name <span style="color: #CC9393;">"~/quicklisp/slime-helper.el"</span>))
                    (<span style="color: #F0DFAF; font-weight: bold;">setq</span> inferior-lisp-program <span style="color: #CC9393;">"/usr/bin/sbcl"</span>
                          slime-contribs '(slime-fancy slime-quicklisp))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">progn</span>
  (use-package-ensure-elpa 'slime
                           '(t)
                           'nil)
  (<span style="color: #F0DFAF; font-weight: bold;">defvar</span> <span style="color: #DFAF8F;">use-package--warning43</span>
    #'(lambda
        (keyword err)
        (<span style="color: #F0DFAF; font-weight: bold;">let</span>
            ((msg
              (format <span style="color: #CC9393;">"%s/%s: %s"</span> 'slime keyword
                      (error-message-string err))))
          (display-warning 'use-package msg <span style="color: #DCDCCC; font-weight: bold;">:error</span>))))
  (<span style="color: #F0DFAF; font-weight: bold;">condition-case</span> err
      (eval-after-load 'slime
        #'(lambda nil
            (<span style="color: #F0DFAF; font-weight: bold;">condition-case</span> err
                (<span style="color: #F0DFAF; font-weight: bold;">progn</span>
                  (load
                   (expand-file-name <span style="color: #CC9393;">"~/quicklisp/slime-helper.el"</span>))
                  (<span style="color: #F0DFAF; font-weight: bold;">setq</span> inferior-lisp-program <span style="color: #CC9393;">"/usr/bin/sbcl"</span> slime-contribs
                        '(slime-fancy slime-quicklisp))
                  t)
              ((debug error)
               (funcall use-package--warning43 <span style="color: #DCDCCC; font-weight: bold;">:config</span> err)))))
    ((debug error)
     (funcall use-package--warning43 <span style="color: #DCDCCC; font-weight: bold;">:catch</span> err))))
</pre>
</div>

<pre class="example">
t

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd6881da" class="outline-2">
<h2 id="orgd6881da"><span class="section-number-2">3</span> Unit 3: Application</h2>
<div class="outline-text-2" id="text-3">
<p>
The last part of the course will be the concrete application of the
lessons I learned. It will involve working through the On Lisp
embedded Prolog DSL, a true bottom-up system. Additionally, I will
also complete a metaprogramming survey, which will involve research
and explanation of the role of metaprogramming in other programming
languages. 
</p>
</div>
<div id="outline-container-orgf8960de" class="outline-3">
<h3 id="orgf8960de"><span class="section-number-3">3.1</span> Tasks</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org88a7d94" class="outline-4">
<h4 id="org88a7d94"><span class="section-number-4">3.1.1</span> <span class="todo TODO">TODO</span> Prolog</h4>
</div>
<div id="outline-container-orgb16c163" class="outline-4">
<h4 id="orgb16c163"><span class="section-number-4">3.1.2</span> <span class="todo TODO">TODO</span> Metaprogramming Survey</h4>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Shukry Zablah (<a href="mailto:shukryzablah@archlinux">shukryzablah@archlinux</a>)</p>
 <p class="exporter">Exporter: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.3 (<a href="https://orgmode.org">Org</a> mode 9.1.9)</p>
 <p class="modified">Last modified: 2020-04-17 Fri 19:58</p>
</div>
</body>
</html>
